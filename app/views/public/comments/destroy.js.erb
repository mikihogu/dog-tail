$ (".comment").html("<%= j(render 'public/comments/comment', post: @post, comment: @comment, comments: @comments) %>");
$ (".comments-count_<%= @post.id %>").html("この施設に関するコメント <i class=\"far fa-comment-dots\"></i> <%= @post.comments.count %>件");

history.replaceState('', '', location.pathname)

//paginationのボタンをあつめる
var items = $('.page-item')
items.each((i, e) => {
  //ボタン内部のaタグを取得
  const link = $(e).find('.page-link')
  //aタグからhrefのURLを取得ない場合は空文字""で代替え
  const linkPath = link.attr('href') || ""
  //URLのparamarorだけ取得
  const pageParam = linkPath.split(/[? &]/).slice(-1)[0]
  //AjaxでおかしくなったURLを適正化
  link.attr('href', `<%= @post.id %>?${pageParam}`)
})
//アクティブになっているボタンを取得
var active = $('.page-item.active')
//アクティブより右にある部品の要素をあつめる
var nextButtons = active.nextAll()
//コメント数が10の倍数の特(controllerで定義)
if (<%== @_destroy %>) {
  //アクティブなボタンより右に要素がない場合
  if (nextButtons.length == 0) {
    //アクティブボタンの左の要素を取得
    const prev = active.prev()
    //左の要素をアクティブにする
    prev.addClass('active')
    //新しいアクティブボタンからリンク先を外す
    prev.find('.page-link').removeAttr('href')
    //元のアクティブボタンを削除
    active.remove()
    
    //アクティブなボタンの右に要素が3つある場合(数字ボタンと次へボタンと最後へボタン)
  } else if (nextButtons.length == 3) {
    //3つの要素をeachで回して
    nextButtons.each( (i, e) => {
      //それぞれ削除
      e.remove()
    })
    //アクティブ要素のリンク先を削除
    active.find('.page-link').removeAttr('href')
    
    //アクティブボタンの右に4つ以上の要素がありKaminariの省略記号が右側にない場合(6pageを超えるとgapクラスのspanが出現)
  } else if (nextButtons.length >= 4 && nextButtons.find('.gap').length == 0) {
    //右側から2つのボタンを排除しindexを数えるためさらに1を引くものを特定したいボタンのindexとして定義
    const index = nextButtons.length - 2 - 1
    //アクティブ要素からリンク先を削除
    active.find('.page-link').removeAttr('href')
    //消したいボタンを特定し削除
    nextButtons[index].remove()
  }
}

//コメント数が60以下のとき(kaminariの省略記号がなくなる境目の数)
if (<%= @post.comments.size <= 60 %>) {
    //省略記号の要素を下記のHTMLに置き換える
    $('.page.gap').replaceWith(
      `
      <li class="page-item">
        <a rel="next" class="page-link" href="/posts/<%= @post.id %>?page=6">6</a>
      </li>
      `
    )
}
$ ("#comment_text_area").val("");
